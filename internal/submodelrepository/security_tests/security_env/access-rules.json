{
  "AllAccessPermissionRules": {
    "DEFATTRIBUTES": [
      { "name": "role_attr", "attributes": [ { "CLAIM": "role" } ] },
      { "name": "member_attr", "attributes": [ { "CLAIM": "role" }, { "CLAIM": "clear" } ] }
    ],

    "DEFOBJECTS": [
      { "name": "all_submodel_read_routes", "objects": [
        { "ROUTE": "/submodels" },
        { "ROUTE": "/submodels/*" },
        { "ROUTE": "/submodels/*/submodel-elements" },
        { "ROUTE": "/submodels/*/submodel-elements/*" }
      ]},
      { "name": "annotated_identifiable", "objects": [
        { "IDENTIFIABLE": "$sm(\"MarcusThisIsAOnlyAnnotatedRelationshipElementSubmodel\")" }
      ]},
      { "name": "relationship_identifiable", "objects": [
        { "IDENTIFIABLE": "$sm(\"MarcusThisIsAOnlyRelationshipElementSubmodel\")" }
      ]},
      { "name": "annotated_referable", "objects": [
        { "REFERABLE": "$sme(\"MarcusThisIsAOnlyAnnotatedRelationshipElementSubmodel\").DemoAnnotatedRelationshipElement" }
      ]},
      { "name": "relationship_referable", "objects": [
        { "REFERABLE": "$sme(\"MarcusThisIsAOnlyRelationshipElementSubmodel\").DemoRelationshipElement" }
      ]},
      { "name": "demo_submodels_route", "objects": [
        { "ROUTE": "/submodels" }
      ]},
      { "name": "demo_submodel_route", "objects": [
        { "ROUTE": "/submodels/aHR0cDovL2llc2UuZnJhdW5ob2Zlci5kZS9pZC9zbS9EZW1vU3VibW9kZWw" }
      ]},
      { "name": "demo_submodel_elements_route", "objects": [
        { "ROUTE": "/submodels/aHR0cDovL2llc2UuZnJhdW5ob2Zlci5kZS9pZC9zbS9EZW1vU3VibW9kZWw/submodel-elements" }
      ]},
      { "name": "demo_relationship_referable", "objects": [
        { "REFERABLE": "$sme(\"http://iese.fraunhofer.de/id/sm/DemoSubmodel\").ExampleSubmodelElementCollection.ExampleRelationshipElement" }
      ]},
      { "name": "demo_annotated_referable", "objects": [
        { "REFERABLE": "$sme(\"http://iese.fraunhofer.de/id/sm/DemoSubmodel\").ExampleSubmodelElementCollection.ExampleAnnotatedRelationshipElement" }
      ]},
      { "name": "demo_list_item_route", "objects": [
        { "ROUTE": "/submodels/aHR0cDovL2llc2UuZnJhdW5ob2Zlci5kZS9pZC9zbS9EZW1vU3VibW9kZWw/submodel-elements/ExampleSubmodelElementCollection.ExampleSubmodelElementListOrdered[0]" }
      ]},
      { "name": "demo_security_allowed_property_route", "objects": [
        { "ROUTE": "/submodels/aHR0cDovL2llc2UuZnJhdW5ob2Zlci5kZS9pZC9zbS9EZW1vU3VibW9kZWw/submodel-elements/SecurityAllowedProperty" }
      ]},
      { "name": "demo_security_update_check_property_route", "objects": [
        { "ROUTE": "/submodels/aHR0cDovL2llc2UuZnJhdW5ob2Zlci5kZS9pZC9zbS9EZW1vU3VibW9kZWw/submodel-elements/SecurityUpdateCheckProperty" }
      ]}
    ],

    "DEFACLS": [
      { "name": "read_role", "acl": { "USEATTRIBUTES": "role_attr", "RIGHTS": ["READ"], "ACCESS": "ALLOW" } },
      { "name": "read_member", "acl": { "USEATTRIBUTES": "member_attr", "RIGHTS": ["READ"], "ACCESS": "ALLOW" } },
      { "name": "create_role", "acl": { "USEATTRIBUTES": "role_attr", "RIGHTS": ["CREATE"], "ACCESS": "ALLOW" } },
      { "name": "update_role", "acl": { "USEATTRIBUTES": "role_attr", "RIGHTS": ["UPDATE"], "ACCESS": "ALLOW" } },
      { "name": "update_member", "acl": { "USEATTRIBUTES": "member_attr", "RIGHTS": ["UPDATE"], "ACCESS": "ALLOW" } },
      { "name": "delete_role", "acl": { "USEATTRIBUTES": "role_attr", "RIGHTS": ["DELETE"], "ACCESS": "ALLOW" } },
      { "name": "admin_all", "acl": { "USEATTRIBUTES": "member_attr", "RIGHTS": ["ALL"], "ACCESS": "ALLOW" } }
    ],

    "DEFFORMULAS": [
      { "name": "always_true", "formula": { "$boolean": true } },
      { "name": "is_admin", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "admin" } ] },
          { "$ge": [ { "$numCast": { "$attribute": { "CLAIM": "clear" } } }, { "$numVal": 10 } ] }
        ]
      }},
      { "name": "viewer_formula_annotated_only", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "viewer" } ] },
          { "$eq": [ { "$field": "$sm#id" }, { "$strVal": "MarcusThisIsAOnlyAnnotatedRelationshipElementSubmodel" } ] },
          { "$eq": [ { "$field": "$sme#idShort" }, { "$strVal": "DemoAnnotatedRelationshipElement" } ] }
        ]
      }},
      { "name": "viewer_member", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "viewer" } ] },
          { "$ge": [ { "$numCast": { "$attribute": { "CLAIM": "clear" } } }, { "$numVal": 1 } ] }
        ]
      }},
      { "name": "editor_only", "formula": {
        "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ]
      }},
      { "name": "editor_any_sme_relationship_semanticid", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$eq": [ { "$field": "$sme#semanticId.keys[].value" }, { "$strVal": "http://acplt.org/RelationshipElements/ExampleRelationshipElement" } ] }
        ]
      }},
      { "name": "editor_any_sme_nonexistent_semanticid", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$eq": [ { "$field": "$sme#semanticId.keys[].value" }, { "$strVal": "no-such-semantic-id" } ] }
        ]
      }},
      { "name": "editor_path_no_index_relationship_semanticid", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$eq": [ { "$field": "$sme.ExampleSubmodelElementCollection.ExampleRelationshipElement#semanticId.keys[].value" }, { "$strVal": "http://acplt.org/RelationshipElements/ExampleRelationshipElement" } ] }
        ]
      }},
      { "name": "editor_member_path_index_relationship_semanticid", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$ge": [ { "$numCast": { "$attribute": { "CLAIM": "clear" } } }, { "$numVal": 1 } ] },
          { "$eq": [ { "$field": "$sme.ExampleSubmodelElementCollection[0].ExampleRelationshipElement#semanticId.keys[].value" }, { "$strVal": "http://acplt.org/RelationshipElements/ExampleRelationshipElement" } ] }
        ]
      }},
      { "name": "editor_member_any_sme_valuetype", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$ge": [ { "$numCast": { "$attribute": { "CLAIM": "clear" } } }, { "$numVal": 1 } ] },
          { "$eq": [ { "$field": "$sme#valueType" }, { "$strVal": "xs:string" } ] }
        ]
      }},
      { "name": "editor_create_allowed_submodel", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$eq": [ { "$field": "$sm#idShort" }, { "$strVal": "SecurityWriteAllowedSubmodel" } ] }
        ]
      }},
      { "name": "editor_create_allowed_sme", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$eq": [ { "$field": "$sme#idShort" }, { "$strVal": "SecurityAllowedProperty" } ] }
        ]
      }},
      { "name": "editor_update_security_allowed_requires_old_and_new_value", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$eq": [ { "$field": "$sme#value" }, { "$strVal": "allowed-write" } ] }
        ]
      }},
      { "name": "editor_member_update_security_check_requires_old_and_new_value", "formula": {
        "$and": [
          { "$eq": [ { "$attribute": { "CLAIM": "role" } }, { "$strVal": "editor" } ] },
          { "$ge": [ { "$numCast": { "$attribute": { "CLAIM": "clear" } } }, { "$numVal": 1 } ] },
          { "$eq": [ { "$field": "$sme#value" }, { "$strVal": "SECURITY_UPDATED_Y" } ] }
        ]
      }}
    ],

    "rules": [
      { "USEACL": "admin_all", "OBJECTS": [ { "ROUTE": "*" } ], "USEFORMULA": "is_admin" },

      { "USEACL": "read_role", "USEOBJECTS": [ "all_submodel_read_routes" ], "USEFORMULA": "viewer_formula_annotated_only" },

      { "USEACL": "read_member", "USEOBJECTS": [ "annotated_identifiable", "annotated_referable" ], "USEFORMULA": "viewer_member" },
      { "USEACL": "read_member", "USEOBJECTS": [ "relationship_identifiable", "relationship_referable" ], "USEFORMULA": "viewer_member" },
      { "USEACL": "read_role", "USEOBJECTS": [ "annotated_referable", "relationship_referable" ], "USEFORMULA": "editor_only" },

      { "USEACL": "read_role", "USEOBJECTS": [ "demo_submodels_route", "demo_submodel_route", "demo_submodel_elements_route" ], "USEFORMULA": "editor_any_sme_relationship_semanticid" },
      { "USEACL": "read_role", "USEOBJECTS": [ "demo_relationship_referable" ], "USEFORMULA": "editor_path_no_index_relationship_semanticid" },
      { "USEACL": "read_role", "USEOBJECTS": [ "demo_annotated_referable" ], "USEFORMULA": "editor_any_sme_nonexistent_semanticid" },

      { "USEACL": "read_member", "USEOBJECTS": [ "demo_relationship_referable" ], "USEFORMULA": "editor_member_path_index_relationship_semanticid" },
      { "USEACL": "read_member", "USEOBJECTS": [ "demo_list_item_route" ], "USEFORMULA": "editor_member_any_sme_valuetype" },

      { "USEACL": "create_role", "USEOBJECTS": [ "demo_submodels_route" ], "USEFORMULA": "editor_create_allowed_submodel" },
      { "USEACL": "create_role", "USEOBJECTS": [ "demo_submodel_elements_route" ], "USEFORMULA": "editor_create_allowed_sme" },

      { "USEACL": "update_role", "USEOBJECTS": [ "demo_security_allowed_property_route" ], "USEFORMULA": "editor_update_security_allowed_requires_old_and_new_value" },
      { "USEACL": "update_member", "USEOBJECTS": [ "demo_security_update_check_property_route" ], "USEFORMULA": "editor_member_update_security_check_requires_old_and_new_value" },

      { "USEACL": "delete_role", "USEOBJECTS": [ "relationship_referable" ], "USEFORMULA": "editor_only" }
    ]
  }
}
